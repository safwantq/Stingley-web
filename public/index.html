<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Noise Levels</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        h1 {
            text-align: center;
            margin-top: 20px;
        }
        #table-container {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 50px;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            justify-items: center;
        }

        .left, .right{
          display: grid;
          /*grid-template-columns: repeat(2, 1fr);*/
          grid-auto-rows: auto;
          gap: 20px;
         width: 100%;
        }

        .table {
            width: 100px;
            height: 100px;
            display: flex;
            justify-content:center ;
            align-items: center;
            border-radius: 50%;
            background-color: #fff;
            transition: transform 0.3s, background-color 0.3s;
        }

        .quiet {
            background-color: rgba(66, 187, 72, 0.795);
        }
        .moderate {
            background-color: rgb(190, 148, 30);
        }
        .noisy {
            background-color: rgb(170, 53, 53);
        }
        .table h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .table p {
            margin: 5px 0;
        }

        .first-table{
          grid-column: 1/span 2;
        }
        .two-per-row{
          grid-template-columns: 1fr 1fr;
        }
    </style>
</head>
<body>
    <h1>Current Table Noise Levels</h1>
    <div id="table-container">
        <!-- Dynamic content will be injected here -->
         <div class="left">

         </div>

         <div class="right">

         </div>
    </div>

    <script>
        // Connect to WebSocket server
        const socket = new WebSocket('ws://' + window.location.host);

        // Listen for messages (table data) from the server
        socket.onmessage = function (event) {
            console.log("Received message from WebSocket:", event.data);  // Log received data
            
            try {
                const tables = JSON.parse(event.data);
                console.log("Parsed tables data:", tables);  // Log parsed data
                
                const leftContainer = document.querySelector('.left');
                const rightContainer = document.querySelector('.right');
                leftContainer.innerHTML = '';
                rightContainer.innerHTML = '';
        

                if (!tables || tables.length === 0) {
                    const noDataMessage = document.createElement('p');
                    noDataMessage.innerText = 'No data available';
                    rightContainer.appendChild(noDataMessage);
                    leftContainer.appendChild(noDataMessage);
                    return;
                }
                  // handeling the left container layout
                  tables.slice(0,9).forEach((table, index) => {
                    const div = document.createElement('div');
                    div.classList.add('table');
                    
                    if (table.noise_level < 300) {
                        div.classList.add('quiet');
                    } else if (table.noise_level < 800) {
                        div.classList.add('moderate');
                    } else {
                        div.classList.add('noisy');
                    }

                    const tablenumber = table.table_name.replace(/\D/g,'');
                    div.innerHTML = `<h2>${tablenumber}</h2>`;

                    if (index === 0){
                      div.classList.add('first-table');
                      leftContainer.appendChild(div)
                    } else {
                        if (!leftContainer.classList.contains('two-per-row')){
                          leftContainer.classList.add('two-per-row');
                        }
                        leftContainer.appendChild(div);
                    }
                  });
                  
                  tables.slice(9,18).forEach((table, index) => {
                    const div = document.createElement('div');
                    div.classList.add('table');
                    
                    if (table.noise_level < 300) {
                        div.classList.add('quiet');
                    } else if (table.noise_level < 800) {
                        div.classList.add('moderate');
                    } else {
                        div.classList.add('noisy');
                    }

                    const tablenumber = table.table_name.replace(/\D/g,'');
                    div.innerHTML = `<h2>${tablenumber}</h2>`;

                    if (index === 0){
                      div.classList.add('first-table');
                      leftContainer.appendChild(div)
                    } else {
                        if (!leftContainer.classList.contains('two-per-row')){
                          leftContainer.classList.add('two-per-row');
                        }
                        leftContainer.appendChild(div);
                    }
                  });
               
            } catch (error) {
                console.error("Error parsing or rendering data:", error);
            }
        };

        // Handle WebSocket errors
        socket.onerror = function (error) {
            console.error('WebSocket Error:', error);  // Log WebSocket errors
        };
    </script>
</body>
</html>
